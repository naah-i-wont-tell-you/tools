<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Page Numbers - XTPdf</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
    }

    body {
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }

    nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      background: #ffffff;
      border-bottom: 1px solid #e8e8e8;
    }

    nav .logo {
      display: flex;
      align-items: center;
      font-size: 20px;
      font-weight: 600;
      color: #333;
      text-decoration: none;
    }

    nav .logo i {
      margin-right: 8px;
      font-size: 18px;
      color: #333;
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 32px;
    }

    nav ul li a {
      text-decoration: none;
      color: #666;
      font-weight: 400;
      font-size: 15px;
      transition: color 0.2s ease;
    }

    nav ul li a:hover {
      color: #333;
    }

    .page-view {
      display: none;
    }

    .page-view.active {
      display: block;
    }

    .hero {
      text-align: center;
      padding: 60px 40px 40px;
      background: #ffffff;
      max-width: 800px;
      margin: 0 auto;
    }

    .hero h1 {
      font-size: 42px;
      font-weight: 700;
      color: #2c3e50;
      margin-bottom: 16px;
      line-height: 1.2;
    }

    .hero p {
      font-size: 18px;
      color: #666;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .hero .features {
      display: flex;
      justify-content: center;
      gap: 40px;
      color: #666;
      font-size: 14px;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .feature-item i {
      font-size: 14px;
      color: #666;
    }

    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 40px;
    }

    .main-section {
      background: #ffffff;
      border-radius: 12px;
      padding: 40px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    .section-title {
      font-size: 24px;
      font-weight: 600;
      color: #333;
      margin-bottom: 30px;
    }

    .upload-area {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 60px 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 40px;
    }

    .upload-area:hover {
      border-color: #2c3e50;
      background: #f8f9fa;
    }

    .upload-area.dragover {
      border-color: #2c3e50;
      background: #f0f8ff;
    }

    .upload-icon {
      width: 60px;
      height: 60px;
      background: #e9ecef;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
    }

    .upload-icon i {
      font-size: 24px;
      color: #999;
    }

    .upload-text {
      font-size: 16px;
      color: #666;
      margin-bottom: 8px;
    }

    .upload-subtext {
      font-size: 14px;
      color: #999;
    }

    .file-input {
      display: none;
    }

    .continue-button {
      width: 100%;
      background: #2c3e50;
      color: #ffffff;
      padding: 16px 32px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .continue-button:hover:not(:disabled) {
      background: #34495e;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(44, 62, 80, 0.2);
    }

    .continue-button:disabled {
      background: #bbb;
      cursor: not-allowed;
    }

    .paginate-interface {
      background: #ffffff;
      min-height: 100vh;
    }

    .paginate-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 40px;
      border-bottom: 1px solid #e8e8e8;
    }

    .back-link {
      display: flex;
      align-items: center;
      color: #666;
      text-decoration: none;
      font-size: 14px;
      margin-bottom: 20px;
      transition: color 0.2s ease;
    }

    .back-link:hover {
      color: #333;
    }

    .back-link i {
      margin-right: 8px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
    }

    .page-subtitle {
      font-size: 16px;
      color: #666;
    }

    .paginate-content {
      display: flex;
      height: calc(100vh - 140px);
    }

    .sidebar {
      width: 320px;
      background: #f8f9fa;
      border-right: 1px solid #e8e8e8;
      padding: 20px;
      overflow-y: auto;
    }

    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 16px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #2c3e50;
    }

    .form-select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      font-size: 14px;
      background: #ffffff;
      cursor: pointer;
    }

    .form-select:focus {
      outline: none;
      border-color: #2c3e50;
    }

    .number-input-group {
      display: flex;
      gap: 10px;
    }

    .color-input-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .color-preview {
      width: 40px;
      height: 40px;
      border-radius: 6px;
      border: 1px solid #e8e8e8;
      cursor: pointer;
    }

    .preview-section {
      background: #ffffff;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #e8e8e8;
      margin-bottom: 20px;
    }

    .preview-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
    }

    .preview-sample {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 6px;
      text-align: center;
      font-family: 'Helvetica', Arial, sans-serif;
      border: 1px solid #e8e8e8;
    }

    .download-section {
      margin-top: auto;
      padding-top: 20px;
      border-top: 1px solid #e8e8e8;
    }

    .download-btn {
      width: 100%;
      background: #28a745;
      color: #ffffff;
      padding: 12px 16px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .download-btn:hover:not(:disabled) {
      background: #218838;
      transform: translateY(-2px);
    }

    .download-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }

    .pdf-viewer {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f0f0f0;
    }

    .viewer-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      background: #ffffff;
      border-bottom: 1px solid #e8e8e8;
    }

    .page-navigation {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .page-nav-btn {
      width: 32px;
      height: 32px;
      border: 1px solid #ddd;
      background: #ffffff;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .page-nav-btn:hover:not(:disabled) {
      border-color: #2c3e50;
      color: #2c3e50;
    }

    .page-nav-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .page-info {
      font-size: 14px;
      color: #666;
    }

    .zoom-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .zoom-btn {
      width: 32px;
      height: 32px;
      border: 1px solid #ddd;
      background: #ffffff;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .zoom-btn:hover {
      border-color: #2c3e50;
      color: #2c3e50;
    }

    .zoom-level {
      font-size: 14px;
      color: #666;
      min-width: 40px;
      text-align: center;
    }

    .pdf-canvas-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      overflow: auto;
      position: relative;
    }

    .pdf-page {
      position: relative;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      background: white;
    }

    .pdf-canvas {
      display: block;
      max-width: 100%;
      height: auto;
    }

    .page-number-overlay {
      position: absolute;
      font-family: 'Helvetica', Arial, sans-serif;
      color: #000;
      pointer-events: none;
      font-size: 12px;
      z-index: 10;
    }

    .status-message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      z-index: 1000;
      animation: slideIn 0.3s ease;
      max-width: 300px;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-info {
      background: #cce7ff;
      color: #004085;
      border: 1px solid #b3d9ff;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .paginate-content {
        flex-direction: column;
        height: auto;
      }

      .sidebar {
        width: 100%;
      }

      nav {
        padding: 16px 20px;
      }

      nav ul {
        display: none;
      }

      .main-content {
        padding: 20px;
      }

      .main-section {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <!-- Upload Page -->
  <div id="uploadPage" class="page-view active">
    <nav>
      <a href="#" class="logo">
        <i class="fa-solid fa-file-pdf"></i>
        XTPdf
      </a>
      <ul>
        <li><a href="#tools">Tools</a></li>
        <li><a href="#features">Features</a></li>
        <li><a href="#about">About</a></li>
      </ul>
    </nav>

    <section class="hero">
      <h1>Add Page Numbers</h1>
      <p>Automatically add professional page numbers to your PDF documents with customizable formatting and positioning</p>
      <div class="features">
        <div class="feature-item">
          <i class="fa-solid fa-shield-halved"></i>
          <span>100% Client-Side Processing</span>
        </div>
        <div class="feature-item">
          <i class="fa-solid fa-cloud-slash"></i>
          <span>No Server Upload</span>
        </div>
        <div class="feature-item">
          <i class="fa-solid fa-hashtag"></i>
          <span>Custom Formatting</span>
        </div>
      </div>
    </section>

    <div class="main-content">
      <div class="main-section">
        <h2 class="section-title">Upload PDF Document</h2>
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">
            <i class="fa-solid fa-cloud-arrow-up"></i>
          </div>
          <div class="upload-text">Drop your PDF here or click to browse</div>
          <div class="upload-subtext">Maximum file size: 50MB</div>
        </div>
        <input type="file" id="fileInput" class="file-input" accept=".pdf">

        <div class="button-container">
          <button class="continue-button" id="continueBtn" disabled>
            <i class="fa-solid fa-play"></i>
            Continue to Page Numbering
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Paginate Interface Page -->
  <div id="paginatePage" class="page-view">
    <div class="paginate-interface">
      <nav>
        <a href="#" class="logo">
          <i class="fa-solid fa-file-pdf"></i>
          XTPdf
        </a>
        <ul>
          <li><a href="#tools">Tools</a></li>
          <li><a href="#features">Features</a></li>
          <li><a href="#about">About</a></li>
        </ul>
      </nav>

      <div class="paginate-header">
        <div>
          <a href="#" class="back-link" id="backToTools">
            <i class="fa-solid fa-arrow-left"></i>
            Back to Tools
          </a>
          <div class="page-title">Add Page Numbers</div>
          <div class="page-subtitle">Customize the format and position of your page numbers</div>
        </div>
      </div>

      <div class="paginate-content">
        <div class="sidebar">
          <div class="sidebar-section">
            <div class="sidebar-title">Page Number Format</div>
            <div class="form-group">
              <label class="form-label">Format Template</label>
              <input type="text" id="formatInput" class="form-input" value="{n} of {p}" placeholder="e.g., Page {n} / {p}">
              <div style="font-size: 12px; color: #666; margin-top: 4px;">
                Use {n} for current page, {p} for total pages
              </div>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-title">Position</div>
            <div class="form-group">
              <label class="form-label">Location</label>
              <select id="positionSelect" class="form-select">
                <option value="bottom-right">Bottom Right</option>
                <option value="bottom-center">Bottom Center</option>
                <option value="bottom-left">Bottom Left</option>
                <option value="top-right">Top Right</option>
                <option value="top-center">Top Center</option>
                <option value="top-left">Top Left</option>
              </select>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="sidebar-title">Appearance</div>
            <div class="form-group">
              <label class="form-label">Font Size</label>
              <input type="number" id="fontSizeInput" class="form-input" value="12" min="8" max="48">
            </div>
            <div class="form-group">
              <label class="form-label">Color</label>
              <div class="color-input-group">
                <input type="text" id="colorInput" class="form-input" value="#000000" style="flex: 1;">
                <div class="color-preview" id="colorPreview" style="background-color: #000000;"></div>
                <input type="color" id="colorPicker" style="display: none;">
              </div>
            </div>
          </div>

          <div class="sidebar-section">
            <div class="preview-section">
              <div class="preview-title">Preview</div>
              <div class="preview-sample" id="previewSample">1 of 5</div>
            </div>
          </div>

          <div class="download-section">
            <button class="download-btn" id="downloadBtn" disabled>
              <i class="fa-solid fa-download"></i>
              Add Numbers & Download
            </button>
          </div>
        </div>

        <div class="pdf-viewer">
          <div class="viewer-toolbar">
            <div class="page-navigation">
              <button class="page-nav-btn" id="prevPage" disabled>
                <i class="fa-solid fa-chevron-left"></i>
              </button>
              <span class="page-info" id="pageInfo">Page 1 of 1</span>
              <button class="page-nav-btn" id="nextPage" disabled>
                <i class="fa-solid fa-chevron-right"></i>
              </button>
            </div>
            <div class="zoom-controls">
              <button class="zoom-btn" id="zoomOut">
                <i class="fa-solid fa-search-minus"></i>
              </button>
              <span class="zoom-level" id="zoomLevel">100%</span>
              <button class="zoom-btn" id="zoomIn">
                <i class="fa-solid fa-search-plus"></i>
              </button>
            </div>
          </div>

          <div class="pdf-canvas-container" id="canvasContainer">
            <div id="loadingMessage" style="text-align: center; padding: 40px; font-size: 16px; color: #666;">Loading PDF...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Set PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // Global variables
    let currentPage = 1;
    let totalPages = 1;
    let zoomLevel = 1.0;
    let selectedFile = null;
    let pdfDoc = null;
    let fileName = 'document';

    function showStatus(message, type = 'success') {
      const statusEl = document.createElement('div');
      statusEl.className = `status-message status-${type}`;
      statusEl.textContent = message;
      document.body.appendChild(statusEl);
      
      setTimeout(() => {
        if (statusEl && statusEl.parentNode) {
          statusEl.parentNode.removeChild(statusEl);
        }
      }, 3000);
    }

    function showPage(pageId) {
      document.querySelectorAll('.page-view').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(pageId).classList.add('active');
    }

    // Upload functionality
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const continueBtn = document.getElementById('continueBtn');

    uploadArea.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (file && file.type === 'application/pdf') {
        selectedFile = file;
        fileName = file.name.replace(/\.pdf$/i, '') || 'document';
        const fileSize = (file.size / (1024 * 1024)).toFixed(1);
        
        uploadArea.innerHTML = `
          <div class="upload-icon">
            <i class="fa-solid fa-file-pdf" style="color: #2c3e50;"></i>
          </div>
          <div class="upload-text" style="color: #2c3e50; font-weight: 500;">${file.name}</div>
          <div class="upload-subtext">Size: ${fileSize} MB - Click to change file</div>
        `;
        
        continueBtn.disabled = false;
        showStatus('PDF loaded successfully!');
      } else {
        showStatus('Please select a valid PDF file', 'error');
      }
    });

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type === 'application/pdf') {
        fileInput.files = e.dataTransfer.files;
        fileInput.dispatchEvent(new Event('change'));
      }
    });

    // Continue button
    continueBtn.addEventListener('click', async () => {
      if (selectedFile) {
        showPage('paginatePage');
        await loadPDF();
      }
    });

    // Load PDF function
    async function loadPDF() {
      try {
        const arrayBuffer = await selectedFile.arrayBuffer();
        pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
        totalPages = pdfDoc.numPages;
        
        await renderPage(1);
        updatePageInfo();
        document.getElementById('downloadBtn').disabled = false;
        updatePreview();
        showStatus('PDF loaded successfully! Adjust settings and preview page numbers.');
      } catch (error) {
        console.error('Error loading PDF:', error);
        showStatus('Error loading PDF file: ' + (error.message || 'Unknown error'), 'error');
      }
    }

    // Render PDF page with page numbers
    async function renderPage(pageNum) {
      try {
        const page = await pdfDoc.getPage(pageNum);
        const viewport = page.getViewport({ scale: zoomLevel });
        
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        canvas.className = 'pdf-canvas';
        
        const pageDiv = document.createElement('div');
        pageDiv.className = 'pdf-page';
        pageDiv.style.width = viewport.width + 'px';
        pageDiv.style.height = viewport.height + 'px';
        pageDiv.appendChild(canvas);
        
        const canvasContainer = document.getElementById('canvasContainer');
        canvasContainer.innerHTML = '';
        canvasContainer.appendChild(pageDiv);
        
        await page.render({
          canvasContext: ctx,
          viewport: viewport
        }).promise;

        // Add page number overlay
        addPageNumberOverlay(pageDiv, pageNum, viewport);
        
      } catch (error) {
        console.error('Error rendering page:', error);
        showStatus('Error rendering PDF page: ' + (error.message || 'Unknown error'), 'error');
      }
    }

    // Add page number overlay to preview
    function addPageNumberOverlay(pageDiv, pageNum, viewport) {
      const format = document.getElementById('formatInput').value || '{n} of {p}';
      const position = document.getElementById('positionSelect').value;
      const fontSize = parseFloat(document.getElementById('fontSizeInput').value) || 12;
      const color = document.getElementById('colorInput').value || '#000000';

      const text = format.replace(/\{n\}/g, pageNum).replace(/\{p\}/g, totalPages);
      
      const overlay = document.createElement('div');
      overlay.className = 'page-number-overlay';
      overlay.textContent = text;
      overlay.style.fontSize = (fontSize * zoomLevel) + 'px';
      overlay.style.color = color;

      // Position the overlay
      const margin = 20 * zoomLevel;
      const textWidth = text.length * fontSize * 0.6 * zoomLevel; // Approximate text width

      switch (position) {
        case 'bottom-right':
          overlay.style.right = margin + 'px';
          overlay.style.bottom = margin + 'px';
          break;
        case 'bottom-center':
          overlay.style.left = '50%';
          overlay.style.transform = 'translateX(-50%)';
          overlay.style.bottom = margin + 'px';
          break;
        case 'bottom-left':
          overlay.style.left = margin + 'px';
          overlay.style.bottom = margin + 'px';
          break;
        case 'top-right':
          overlay.style.right = margin + 'px';
          overlay.style.top = margin + 'px';
          break;
        case 'top-center':
          overlay.style.left = '50%';
          overlay.style.transform = 'translateX(-50%)';
          overlay.style.top = margin + 'px';
          break;
        case 'top-left':
          overlay.style.left = margin + 'px';
          overlay.style.top = margin + 'px';
          break;
      }

      pageDiv.appendChild(overlay);
    }

    // Update preview sample
    function updatePreview() {
      const format = document.getElementById('formatInput').value || '{n} of {p}';
      const fontSize = parseFloat(document.getElementById('fontSizeInput').value) || 12;
      const color = document.getElementById('colorInput').value || '#000000';

      const previewSample = document.getElementById('previewSample');
      const sampleText = format.replace(/\{n\}/g, '1').replace(/\{p\}/g, totalPages || '5');
      
      previewSample.textContent = sampleText;
      previewSample.style.fontSize = fontSize + 'px';
      previewSample.style.color = color;

      // Update current page if PDF is loaded
      if (pdfDoc) {
        renderPage(currentPage);
      }
    }

    // Page navigation
    document.getElementById('prevPage').addEventListener('click', async () => {
      if (currentPage > 1) {
        currentPage--;
        await renderPage(currentPage);
        updatePageInfo();
      }
    });

    document.getElementById('nextPage').addEventListener('click', async () => {
      if (currentPage < totalPages) {
        currentPage++;
        await renderPage(currentPage);
        updatePageInfo();
      }
    });

    // Zoom controls
    document.getElementById('zoomIn').addEventListener('click', async () => {
      if (zoomLevel < 3.0) {
        zoomLevel += 0.25;
        await renderPage(currentPage);
        document.getElementById('zoomLevel').textContent = Math.round(zoomLevel * 100) + '%';
      }
    });

    document.getElementById('zoomOut').addEventListener('click', async () => {
      if (zoomLevel > 0.5) {
        zoomLevel -= 0.25;
        await renderPage(currentPage);
        document.getElementById('zoomLevel').textContent = Math.round(zoomLevel * 100) + '%';
      }
    });

    function updatePageInfo() {
      document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
      document.getElementById('prevPage').disabled = currentPage === 1;
      document.getElementById('nextPage').disabled = currentPage === totalPages;
    }

    // Settings event listeners
    document.getElementById('formatInput').addEventListener('input', updatePreview);
    document.getElementById('positionSelect').addEventListener('change', updatePreview);
    document.getElementById('fontSizeInput').addEventListener('input', updatePreview);
    document.getElementById('colorInput').addEventListener('input', (e) => {
      document.getElementById('colorPreview').style.backgroundColor = e.target.value;
      updatePreview();
    });

    // Color picker functionality
    document.getElementById('colorPreview').addEventListener('click', () => {
      document.getElementById('colorPicker').click();
    });

    document.getElementById('colorPicker').addEventListener('change', (e) => {
      document.getElementById('colorInput').value = e.target.value;
      document.getElementById('colorPreview').style.backgroundColor = e.target.value;
      updatePreview();
    });

    // Back button
    document.getElementById('backToTools').addEventListener('click', (e) => {
      e.preventDefault();
      showPage('uploadPage');
      selectedFile = null;
      pdfDoc = null;
      currentPage = 1;
      totalPages = 1;
      zoomLevel = 1.0;
      continueBtn.disabled = true;
      document.getElementById('downloadBtn').disabled = true;
      uploadArea.innerHTML = `
        <div class="upload-icon">
          <i class="fa-solid fa-cloud-arrow-up"></i>
        </div>
        <div class="upload-text">Drop your PDF here or click to browse</div>
        <div class="upload-subtext">Maximum file size: 50MB</div>
      `;
      // Reset form values
      document.getElementById('formatInput').value = '{n} of {p}';
      document.getElementById('positionSelect').value = 'bottom-right';
      document.getElementById('fontSizeInput').value = '12';
      document.getElementById('colorInput').value = '#000000';
      document.getElementById('colorPreview').style.backgroundColor = '#000000';
      document.getElementById('zoomLevel').textContent = '100%';
    });

    // Download functionality
    document.getElementById('downloadBtn').addEventListener('click', async () => {
      if (!selectedFile || !pdfDoc) {
        showStatus('No PDF loaded', 'error');
        return;
      }

      const downloadBtn = document.getElementById('downloadBtn');
      const originalText = downloadBtn.innerHTML;

      try {
        downloadBtn.disabled = true;
        downloadBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Processing...';
        showStatus('Adding page numbers to PDF...', 'info');

        // Get current settings
        const format = document.getElementById('formatInput').value || '{n} of {p}';
        const position = document.getElementById('positionSelect').value;
        const fontSize = parseFloat(document.getElementById('fontSizeInput').value) || 12;
        const colorHex = (document.getElementById('colorInput').value || '#000000').replace('#', '');
        
        // Convert hex to RGB
        const r = parseInt(colorHex.substring(0, 2), 16) || 0;
        const g = parseInt(colorHex.substring(2, 4), 16) || 0;
        const b = parseInt(colorHex.substring(4, 6), 16) || 0;

        // Load PDF with pdf-lib
        const pdfBytes = await selectedFile.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);
        const helveticaFont = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
        const pages = pdfDoc.getPages();
        const total = pages.length;

        // Add page numbers to each page
        for (let i = 0; i < pages.length; i++) {
          const page = pages[i];
          const { width, height } = page.getSize();
          const pageNumber = i + 1;
          const text = format.replace(/\{n\}/g, pageNumber).replace(/\{p\}/g, total);
          const textWidth = helveticaFont.widthOfTextAtSize(text, fontSize);
          
          let x = 0, y = 0;
          const margin = 20;
          
          // Calculate position
          switch (position) {
            case 'bottom-right':
              x = width - margin - textWidth;
              y = margin;
              break;
            case 'bottom-left':
              x = margin;
              y = margin;
              break;
            case 'bottom-center':
              x = (width - textWidth) / 2;
              y = margin;
              break;
            case 'top-right':
              x = width - margin - textWidth;
              y = height - margin - fontSize;
              break;
            case 'top-left':
              x = margin;
              y = height - margin - fontSize;
              break;
            case 'top-center':
              x = (width - textWidth) / 2;
              y = height - margin - fontSize;
              break;
          }
          
          // Add text to page
          page.drawText(text, {
            x,
            y,
            size: fontSize,
            font: helveticaFont,
            color: PDFLib.rgb(r / 255, g / 255, b / 255)
          });
        }

        // Save and download
        const pdfBytesWithNumbers = await pdfDoc.save();
        const blob = new Blob([pdfBytesWithNumbers], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `${fileName}_paginated.pdf`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        showStatus(`Successfully added page numbers to ${total} pages!`);
        
      } catch (error) {
        console.error('Error processing PDF:', error);
        showStatus('Error adding page numbers: ' + (error.message || 'Unknown error'), 'error');
      } finally {
        downloadBtn.disabled = false;
        downloadBtn.innerHTML = originalText;
      }
    });

    // Initialize
    showStatus('PDF Page Number Tool Ready!', 'info');

  </script>
</body>
</html>